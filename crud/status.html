<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Status</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .status-card { background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 500px; animation: fadeIn 0.5s; }
        .card-header { background: #FFA000; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
        .card-header h1 { margin: 0; font-size: 1.5em; }
        .card-body { padding: 30px; }
        .status-item { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid #eee; font-size: 1.05em; }
        .status-item:last-child { border-bottom: none; }
        .status-label { font-weight: 600; color: #555; }
        .status-value { color: #333; text-align: right; }
        .status-message { text-align: center; padding: 40px; color: #777; font-size: 1.1em; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="status-card">
        <div class="card-header"><h1><i class="fas fa-clipboard-check"></i> Registration Status</h1></div>
        <div class="card-body" id="status-container">
            <div class="status-message" id="loading-message"><i class="fas fa-spinner fa-spin"></i> Loading Registration Details...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // --- Use the same Firebase config as your admin app ---
        const firebaseConfig = {
            apiKey: "AIzaSyDNF3AtYFZWVT7K8sAuwjNnyC1sLwlCsHM",
            authDomain: "crud-application-mg.firebaseapp.com",
            databaseURL: "https://crud-application-mg-default-rtdb.firebaseio.com",
            projectId: "crud-application-mg",
            storageBucket: "crud-application-mg.firebasestorage.app",
            messagingSenderId: "926558792141",
            appId: "1:926558792141:web:ad2141d1b776e7c82f7c84"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function displayStatus(data) {
            const container = document.getElementById('status-container');
            container.innerHTML = `
                <div class="status-item"><span class="status-label">Name</span><span class="status-value">${escapeHtml(data.participantName || 'N/A')}</span></div>
                <div class="status-item"><span class="status-label">Event</span><span class="status-value">${escapeHtml(data.eventName || 'N/A')}</span></div>
                <div class="status-item"><span class="status-label">Ticket Type</span><span class="status-value">${escapeHtml(data.registrationType || 'N/A')}</span></div>
                <div class="status-item"><span class="status-label">Payment</span><span class="status-value" style="font-weight: bold;">${escapeHtml(data.paymentStatus || 'N/A')}</span></div>
                <div class="status-item"><span class="status-label">Registered On</span><span class="status-value">${new Date(data.createdAt).toLocaleDateString()}</span></div>
            `;
        }

        function displayError(message) {
            document.getElementById('status-container').innerHTML = `<div class="status-message">${escapeHtml(message)}</div>`;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const participantId = params.get('id');

            if (!participantId) {
                displayError('No Registration ID was provided in the link.');
                return;
            }

            try {
                const participantRef = ref(database, `participants/${participantId}`);
                const snapshot = await get(participantRef);
                if (snapshot.exists()) {
                    displayStatus(snapshot.val());
                } else {
                    displayError('This registration could not be found. Please check the link or contact support.');
                }
            } catch (error) {
                console.error("Error fetching status:", error);
                displayError('An error occurred while trying to retrieve the registration status.');
            }
        });
    </script>
</body>
</html>
